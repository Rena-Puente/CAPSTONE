<section class="admin-careers">
  <header class="admin-careers__header">
    <h2 class="admin-careers__title">Carreras</h2>
    <p class="admin-careers__subtitle">
      Administra las carreras disponibles para el perfil de los candidatos y los niveles de seniority en las ofertas.
    </p>
  </header>

  <form class="admin-careers__form" [formGroup]="form" (ngSubmit)="createCareer()" novalidate>
    <div class="admin-careers__form-grid">
      <div class="admin-careers__field">
        <label for="careerCategory" class="admin-careers__label">Categoría</label>
        <input
          type="text"
          id="careerCategory"
          class="admin-careers__control"
          placeholder="Ej. Programación y Desarrollo"
          formControlName="category"
          [class.is-invalid]="shouldShowError('category')"
        />
        <div class="admin-careers__error" *ngIf="getControlError('category')">
          {{ getControlError('category') }}
        </div>
      </div>

      <div class="admin-careers__field">
        <label for="careerName" class="admin-careers__label">Carrera</label>
        <input
          type="text"
          id="careerName"
          class="admin-careers__control"
          placeholder="Ej. Desarrollo Web Full Stack"
          formControlName="career"
          [class.is-invalid]="shouldShowError('career')"
        />
        <div class="admin-careers__error" *ngIf="getControlError('career')">
          {{ getControlError('career') }}
        </div>
      </div>
    </div>

    <div class="admin-careers__actions">
      <button type="submit" class="admin-careers__submit" [disabled]="isSubmitting()">
        <span class="admin-careers__spinner" *ngIf="isSubmitting()" aria-hidden="true"></span>
        Agregar carrera
      </button>
      <span class="admin-careers__feedback admin-careers__feedback--success" *ngIf="submitSuccess()">
        {{ submitSuccess() }}
      </span>
      <span class="admin-careers__feedback admin-careers__feedback--error" *ngIf="submitError()">
        {{ submitError() }}
      </span>
    </div>
  </form>

  <section class="admin-careers__catalog">
    <div class="admin-careers__catalog-controls">
      <button
        type="button"
        class="admin-careers__catalog-toggle"
        (click)="toggleCatalog()"
        [attr.aria-expanded]="isCatalogExpanded()"
        aria-controls="adminCareersCatalogPanel"
      >
        {{ isCatalogExpanded() ? 'Ocultar catálogo' : 'Mostrar catálogo' }}
      </button>

      <span class="admin-careers__hint" *ngIf="!isCatalogExpanded()">
        Expande el catálogo cuando necesites revisar las carreras registradas.
      </span>
    </div>

    <div
      *ngIf="isCatalogExpanded()"
      id="adminCareersCatalogPanel"
      class="admin-careers__catalog-panel"
      aria-live="polite"
    >
      <div class="admin-careers__hint" *ngIf="loading()">Cargando catálogo...</div>

      <div class="admin-careers__alert admin-careers__alert--error" *ngIf="error()">
        {{ error() }}
        <button type="button" class="admin-careers__retry" (click)="refreshCatalog()">Reintentar</button>
      </div>

      <ng-container *ngIf="!loading() && !error()">
        <div class="admin-careers__hint" *ngIf="catalog().length === 0">
          Aún no hay carreras registradas.
        </div>

        <div *ngIf="catalog().length > 0" class="admin-careers__catalog-header">
          <div class="admin-careers__catalog-header-text">
            <h3 class="admin-careers__catalog-title">Listado por categoría</h3>
            <p class="admin-careers__catalog-subtitle">Explora y gestiona todas las carreras disponibles.</p>
          </div>
          <span class="admin-careers__catalog-total">
            {{ totalCareers() }} {{ totalCareers() === 1 ? 'carrera' : 'carreras' }}
          </span>
        </div>

        <div class="admin-careers__list-wrapper" *ngIf="catalog().length > 0">
          <ul class="admin-careers__hierarchy" aria-label="Catálogo de carreras">
            <li class="admin-careers__hierarchy-root">
              <div class="admin-careers__root-label">
                <span class="admin-careers__root-text">Carreras</span>
                <span class="admin-careers__count">
                  {{ totalCareers() }}
                  {{ totalCareers() === 1 ? 'carrera' : 'carreras' }}
                </span>
              </div>

              <ul class="admin-careers__categories-list">
                <li class="admin-careers__category-item" *ngFor="let category of catalog()">
                  <div class="admin-careers__category-label">
                    <span class="admin-careers__category-name">{{ category.category }}</span>
                    <span class="admin-careers__count">
                      {{ category.items.length }}
                      {{ category.items.length === 1 ? 'carrera' : 'carreras' }}
                    </span>
                  </div>

                  <ul class="admin-careers__careers-list">
                    <li class="admin-careers__career-item" *ngFor="let item of category.items">
                      <div class="admin-careers__option" [attr.data-career-id]="item.id ?? 'sin-id'">
                        <div class="admin-careers__option-info">
                          <span
                            class="admin-careers__badge"
                            [class.admin-careers__badge--empty]="!item.id"
                            >{{ item.id ?? 'Sin ID' }}</span
                          >
                          <span class="admin-careers__option-name">{{ item.name }}</span>
                        </div>

                        <button
                          type="button"
                          class="admin-careers__delete"
                          (click)="deleteCareer(category, item)"
                          [disabled]="isDeleting(category, item)"
                        >
                          <span class="admin-careers__spinner" *ngIf="isDeleting(category, item)" aria-hidden="true"></span>
                          <span>{{ isDeleting(category, item) ? 'Eliminando…' : 'Eliminar' }}</span>
                        </button>
                      </div>
                    </li>

                    <li class="admin-careers__career-item" *ngIf="category.items.length === 0">
                      <div class="admin-careers__empty">
                        Esta categoría aún no tiene carreras registradas.
                      </div>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </ng-container>

      <div class="admin-careers__alert admin-careers__alert--error" *ngIf="deleteError()">
        {{ deleteError() }}
      </div>
    </div>
  </section>

  <div class="admin-careers__divider" role="presentation"></div>

  <section class="admin-skills">
    <header class="admin-skills__header">
      <h3 class="admin-skills__title">Habilidades</h3>
      <p class="admin-skills__subtitle">
        Administra el catálogo de habilidades disponibles para los perfiles y las postulaciones.
      </p>
    </header>

    <form
      class="admin-careers__form admin-skills__form"
      [formGroup]="skillForm"
      (ngSubmit)="createSkill()"
      novalidate
    >
      <div class="admin-careers__form-grid">
        <div class="admin-careers__field">
          <label for="skillCategory" class="admin-careers__label">Categoría</label>
          <input
            type="text"
            id="skillCategory"
            class="admin-careers__control"
            placeholder="Ej. Lenguajes de programación"
            formControlName="category"
            [class.is-invalid]="shouldShowSkillError('category')"
          />
          <div class="admin-careers__error" *ngIf="getSkillControlError('category')">
            {{ getSkillControlError('category') }}
          </div>
        </div>

        <div class="admin-careers__field">
          <label for="skillName" class="admin-careers__label">Habilidad</label>
          <input
            type="text"
            id="skillName"
            class="admin-careers__control"
            placeholder="Ej. Angular"
            formControlName="skill"
            [class.is-invalid]="shouldShowSkillError('skill')"
          />
          <div class="admin-careers__error" *ngIf="getSkillControlError('skill')">
            {{ getSkillControlError('skill') }}
          </div>
        </div>
      </div>

      <div class="admin-careers__actions">
        <button type="submit" class="admin-careers__submit" [disabled]="skillIsSubmitting()">
          <span class="admin-careers__spinner" *ngIf="skillIsSubmitting()" aria-hidden="true"></span>
          Agregar habilidad
        </button>
        <span class="admin-careers__feedback admin-careers__feedback--success" *ngIf="skillSubmitSuccess()">
          {{ skillSubmitSuccess() }}
        </span>
        <span class="admin-careers__feedback admin-careers__feedback--error" *ngIf="skillSubmitError()">
          {{ skillSubmitError() }}
        </span>
      </div>
    </form>

    <section class="admin-careers__catalog admin-skills__catalog">
      <div class="admin-careers__catalog-controls">
        <button
          type="button"
          class="admin-careers__catalog-toggle"
          (click)="toggleSkillCatalog()"
          [attr.aria-expanded]="isSkillCatalogExpanded()"
          aria-controls="adminSkillsCatalogPanel"
        >
          {{ isSkillCatalogExpanded() ? 'Ocultar catálogo' : 'Mostrar catálogo' }}
        </button>

        <span class="admin-careers__hint" *ngIf="!isSkillCatalogExpanded()">
          Expande el catálogo cuando necesites revisar las habilidades registradas.
        </span>
      </div>

      <div
        *ngIf="isSkillCatalogExpanded()"
        id="adminSkillsCatalogPanel"
        class="admin-careers__catalog-panel"
        aria-live="polite"
      >
        <div class="admin-careers__hint" *ngIf="skillsLoading()">Cargando catálogo...</div>

        <div class="admin-careers__alert admin-careers__alert--error" *ngIf="skillsError()">
          {{ skillsError() }}
          <button type="button" class="admin-careers__retry" (click)="refreshSkills()">Reintentar</button>
        </div>

        <ng-container *ngIf="!skillsLoading() && !skillsError()">
          <div class="admin-careers__hint" *ngIf="skills().length === 0">
            Aún no hay habilidades registradas.
          </div>

          <div *ngIf="skills().length > 0" class="admin-careers__catalog-header">
            <div class="admin-careers__catalog-header-text">
              <h3 class="admin-careers__catalog-title">Catálogo de habilidades</h3>
              <p class="admin-careers__catalog-subtitle">
                Consulta y gestiona las habilidades disponibles en el sistema.
              </p>
            </div>
            <span class="admin-careers__catalog-total">
              {{ totalSkills() }} {{ totalSkills() === 1 ? 'habilidad' : 'habilidades' }}
            </span>
          </div>

          <div class="admin-careers__list-wrapper" *ngIf="skillsByCategory().length > 0">
            <ul class="admin-careers__hierarchy" aria-label="Catálogo de habilidades">
              <li class="admin-careers__hierarchy-root">
                <div class="admin-careers__root-label">
                  <span class="admin-careers__root-text">Habilidades</span>
                  <span class="admin-careers__count">
                    {{ totalSkills() }} {{ totalSkills() === 1 ? 'habilidad' : 'habilidades' }}
                  </span>
                </div>

                <ul class="admin-careers__categories-list">
                  <li class="admin-careers__category-item" *ngFor="let group of skillsByCategory()">
                    <div class="admin-careers__category-label">
                      <span class="admin-careers__category-name">{{ group.category }}</span>
                      <span class="admin-careers__count">
                        {{ group.items.length }}
                        {{ group.items.length === 1 ? 'habilidad' : 'habilidades' }}
                      </span>
                    </div>

                    <ul class="admin-careers__careers-list">
                      <li class="admin-careers__career-item" *ngFor="let skill of group.items">
                        <div class="admin-careers__option" [attr.data-skill-id]="skill.id ?? 'sin-id'">
                          <div class="admin-careers__option-info">
                            <span
                              class="admin-careers__badge"
                              [class.admin-careers__badge--empty]="!skill.id"
                              >{{ skill.id ?? 'Sin ID' }}</span
                            >
                            <span class="admin-careers__option-name">{{ skill.name }}</span>
                          </div>

                          <button
                            type="button"
                            class="admin-careers__delete"
                            (click)="deleteSkill(skill)"
                            [disabled]="isSkillDeleting(skill)"
                          >
                            <span class="admin-careers__spinner" *ngIf="isSkillDeleting(skill)" aria-hidden="true"></span>
                            <span>{{ isSkillDeleting(skill) ? 'Eliminando…' : 'Eliminar' }}</span>
                          </button>
                        </div>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </ng-container>

        <div class="admin-careers__alert admin-careers__alert--error" *ngIf="skillDeleteError()">
          {{ skillDeleteError() }}
        </div>
      </div>
    </section>
  </section>

  <div class="admin-careers__divider" role="presentation"></div>

  <section class="admin-study-houses">
    <header class="admin-study-houses__header">
      <h3 class="admin-study-houses__title">Casas de estudios</h3>
      <p class="admin-study-houses__subtitle">
        Administra el catálogo de casas de estudios disponibles para los perfiles y las postulaciones.
      </p>
    </header>

    <form
      class="admin-careers__form admin-study-houses__form"
      [formGroup]="houseForm"
      (ngSubmit)="createStudyHouse()"
      novalidate
    >
      <div class="admin-careers__form-grid">
        <div class="admin-careers__field">
          <label for="studyHouseName" class="admin-careers__label">Casa de estudios</label>
          <input
            type="text"
            id="studyHouseName"
            class="admin-careers__control"
            placeholder="Ej. Universidad de La Serena"
            formControlName="house"
            [class.is-invalid]="shouldShowHouseError('house')"
          />
          <div class="admin-careers__error" *ngIf="getHouseControlError('house')">
            {{ getHouseControlError('house') }}
          </div>
        </div>
      </div>

      <div class="admin-careers__actions">
        <button type="submit" class="admin-careers__submit" [disabled]="houseIsSubmitting()">
          <span class="admin-careers__spinner" *ngIf="houseIsSubmitting()" aria-hidden="true"></span>
          Agregar casa de estudios
        </button>
        <span class="admin-careers__feedback admin-careers__feedback--success" *ngIf="houseSubmitSuccess()">
          {{ houseSubmitSuccess() }}
        </span>
        <span class="admin-careers__feedback admin-careers__feedback--error" *ngIf="houseSubmitError()">
          {{ houseSubmitError() }}
        </span>
      </div>
    </form>

    <section class="admin-careers__catalog admin-study-houses__catalog">
      <div class="admin-careers__catalog-controls">
        <button
          type="button"
          class="admin-careers__catalog-toggle"
          (click)="toggleHouseCatalog()"
          [attr.aria-expanded]="isHouseCatalogExpanded()"
          aria-controls="adminStudyHousesCatalogPanel"
        >
          {{ isHouseCatalogExpanded() ? 'Ocultar catálogo' : 'Mostrar catálogo' }}
        </button>

        <span class="admin-careers__hint" *ngIf="!isHouseCatalogExpanded()">
          Expande el catálogo cuando necesites revisar las casas de estudios registradas.
        </span>
      </div>

      <div
        *ngIf="isHouseCatalogExpanded()"
        id="adminStudyHousesCatalogPanel"
        class="admin-careers__catalog-panel"
        aria-live="polite"
      >
        <div class="admin-careers__hint" *ngIf="housesLoading()">Cargando catálogo...</div>

        <div class="admin-careers__alert admin-careers__alert--error" *ngIf="housesError()">
          {{ housesError() }}
          <button type="button" class="admin-careers__retry" (click)="refreshStudyHouses()">Reintentar</button>
        </div>

        <ng-container *ngIf="!housesLoading() && !housesError()">
          <div class="admin-careers__hint" *ngIf="houses().length === 0">
            Aún no hay casas de estudios registradas.
          </div>

          <div *ngIf="houses().length > 0" class="admin-careers__catalog-header">
            <div class="admin-careers__catalog-header-text">
              <h3 class="admin-careers__catalog-title">Listado de casas de estudios</h3>
              <p class="admin-careers__catalog-subtitle">
                Consulta y gestiona los establecimientos académicos registrados.
              </p>
            </div>
            <span class="admin-careers__catalog-total">
              {{ totalStudyHouses() }}
              {{ totalStudyHouses() === 1 ? 'casa de estudios' : 'casas de estudios' }}
            </span>
          </div>

          <div class="admin-careers__list-wrapper" *ngIf="houses().length > 0">
            <ul class="admin-study-houses__list" aria-label="Casas de estudios registradas">
              <li class="admin-study-houses__item" *ngFor="let house of houses()">
                <div class="admin-careers__option" [attr.data-house-id]="house.id ?? 'sin-id'">
                  <div class="admin-careers__option-info">
                    <span
                      class="admin-careers__badge"
                      [class.admin-careers__badge--empty]="!house.id"
                      >{{ house.id ?? 'Sin ID' }}</span
                    >
                    <span class="admin-careers__option-name">{{ house.name }}</span>
                  </div>

                  <button
                    type="button"
                    class="admin-careers__delete"
                    (click)="deleteStudyHouse(house)"
                    [disabled]="isHouseDeleting(house)"
                  >
                    <span class="admin-careers__spinner" *ngIf="isHouseDeleting(house)" aria-hidden="true"></span>
                    <span>{{ isHouseDeleting(house) ? 'Eliminando…' : 'Eliminar' }}</span>
                  </button>
                </div>
              </li>
            </ul>
          </div>
        </ng-container>

        <div class="admin-careers__alert admin-careers__alert--error" *ngIf="houseDeleteError()">
          {{ houseDeleteError() }}
        </div>
      </div>
    </section>
  </section>
</section>
