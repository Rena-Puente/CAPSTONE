<section class="admin-careers">
  <header class="admin-careers__header">
    <h2 class="admin-careers__title">Carreras</h2>
    <p class="admin-careers__subtitle">
      Administra las carreras disponibles para el perfil de los candidatos y los niveles de seniority en las ofertas.
    </p>
  </header>

  <form class="admin-careers__form" [formGroup]="form" (ngSubmit)="createCareer()" novalidate>
    <div class="admin-careers__form-grid">
      <div class="admin-careers__field">
        <label for="careerCategory" class="admin-careers__label">Categoría</label>
        <input
          type="text"
          id="careerCategory"
          class="admin-careers__control"
          placeholder="Ej. Programación y Desarrollo"
          formControlName="category"
          [class.is-invalid]="shouldShowError('category')"
        />
        <div class="admin-careers__error" *ngIf="getControlError('category')">
          {{ getControlError('category') }}
        </div>
      </div>

      <div class="admin-careers__field">
        <label for="careerName" class="admin-careers__label">Carrera</label>
        <input
          type="text"
          id="careerName"
          class="admin-careers__control"
          placeholder="Ej. Desarrollo Web Full Stack"
          formControlName="career"
          [class.is-invalid]="shouldShowError('career')"
        />
        <div class="admin-careers__error" *ngIf="getControlError('career')">
          {{ getControlError('career') }}
        </div>
      </div>
    </div>

    <div class="admin-careers__actions">
      <button type="submit" class="admin-careers__submit" [disabled]="isSubmitting()">
        <span class="admin-careers__spinner" *ngIf="isSubmitting()" aria-hidden="true"></span>
        Agregar carrera
      </button>
      <span class="admin-careers__feedback admin-careers__feedback--success" *ngIf="submitSuccess()">
        {{ submitSuccess() }}
      </span>
      <span class="admin-careers__feedback admin-careers__feedback--error" *ngIf="submitError()">
        {{ submitError() }}
      </span>
    </div>
  </form>

  <section class="admin-careers__catalog">
    <div class="admin-careers__catalog-controls">
      <button
        type="button"
        class="admin-careers__catalog-toggle"
        (click)="toggleCatalog()"
        [attr.aria-expanded]="isCatalogExpanded()"
        aria-controls="adminCareersCatalogPanel"
      >
        {{ isCatalogExpanded() ? 'Ocultar catálogo' : 'Mostrar catálogo' }}
      </button>

      <span class="admin-careers__hint" *ngIf="!isCatalogExpanded()">
        Expande el catálogo cuando necesites revisar las carreras registradas.
      </span>
    </div>

    <div
      *ngIf="isCatalogExpanded()"
      id="adminCareersCatalogPanel"
      class="admin-careers__catalog-panel"
      aria-live="polite"
    >
      <div class="admin-careers__hint" *ngIf="loading()">Cargando catálogo...</div>

      <div class="admin-careers__alert admin-careers__alert--error" *ngIf="error()">
        {{ error() }}
        <button type="button" class="admin-careers__retry" (click)="refreshCatalog()">Reintentar</button>
      </div>

      <ng-container *ngIf="!loading() && !error()">
        <div class="admin-careers__hint" *ngIf="catalog().length === 0">
          Aún no hay carreras registradas.
        </div>

        <div *ngIf="catalog().length > 0" class="admin-careers__catalog-header">
          <div class="admin-careers__catalog-header-text">
            <h3 class="admin-careers__catalog-title">Listado por categoría</h3>
            <p class="admin-careers__catalog-subtitle">Explora y gestiona todas las carreras disponibles.</p>
          </div>
          <span class="admin-careers__catalog-total">
            {{ totalCareers() }} {{ totalCareers() === 1 ? 'carrera' : 'carreras' }}
          </span>
        </div>

        <div class="admin-careers__list-wrapper" *ngIf="catalog().length > 0">
          <ul class="admin-careers__hierarchy" aria-label="Catálogo de carreras">
            <li class="admin-careers__hierarchy-root">
              <div class="admin-careers__root-label">
                <span class="admin-careers__root-text">Carreras</span>
                <span class="admin-careers__count">
                  {{ totalCareers() }}
                  {{ totalCareers() === 1 ? 'carrera' : 'carreras' }}
                </span>
              </div>

              <ul class="admin-careers__categories-list">
                <li class="admin-careers__category-item" *ngFor="let category of catalog()">
                  <div class="admin-careers__category-label">
                    <span class="admin-careers__category-name">{{ category.category }}</span>
                    <span class="admin-careers__count">
                      {{ category.items.length }}
                      {{ category.items.length === 1 ? 'carrera' : 'carreras' }}
                    </span>
                  </div>

                  <ul class="admin-careers__careers-list">
                    <li class="admin-careers__career-item" *ngFor="let item of category.items">
                      <div class="admin-careers__option" [attr.data-career-id]="item.id ?? 'sin-id'">
                        <div class="admin-careers__option-info">
                          <span
                            class="admin-careers__badge"
                            [class.admin-careers__badge--empty]="!item.id"
                            >{{ item.id ?? 'Sin ID' }}</span
                          >
                          <span class="admin-careers__option-name">{{ item.name }}</span>
                        </div>

                        <button
                          type="button"
                          class="admin-careers__delete"
                          (click)="deleteCareer(category, item)"
                          [disabled]="isDeleting(category, item)"
                        >
                          <span class="admin-careers__spinner" *ngIf="isDeleting(category, item)" aria-hidden="true"></span>
                          <span>{{ isDeleting(category, item) ? 'Eliminando…' : 'Eliminar' }}</span>
                        </button>
                      </div>
                    </li>

                    <li class="admin-careers__career-item" *ngIf="category.items.length === 0">
                      <div class="admin-careers__empty">
                        Esta categoría aún no tiene carreras registradas.
                      </div>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </ng-container>

      <div class="admin-careers__alert admin-careers__alert--error" *ngIf="deleteError()">
        {{ deleteError() }}
      </div>
    </div>
  </section>
</section>
