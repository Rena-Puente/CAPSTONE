<section class="public-profile container py-5">
  <div class="row justify-content-center">
    <div class="col-xxl-9 col-xl-8 col-lg-9">
      <div class="card bg-dark text-light border-secondary shadow">
        <div class="card-body p-4 p-lg-5">
          <header class="public-profile__intro mb-4">
            <h1 class="h4 mb-1 text-white">Perfil público</h1>
            <p class="mb-0 text-secondary">
              Explora la trayectoria profesional compartida por nuestra comunidad InfoTex.
            </p>
          </header>

          <div *ngIf="loading()" class="public-profile__loading text-center py-5">
            <div class="spinner-border text-light" role="status">
              <span class="visually-hidden">Cargando…</span>
            </div>
            <p class="mt-3 mb-0 text-secondary">Preparando el perfil solicitado…</p>
          </div>

          <ng-container *ngIf="!loading()">
            <div *ngIf="error(); else profileContent" class="alert alert-warning mb-0" role="alert">
              {{ error() }}
            </div>

            <ng-template #profileContent>
              <ng-container *ngIf="profile() as data">
                <div class="public-profile__overview d-flex flex-column flex-lg-row align-items-start gap-4 mb-5">
                  <div class="public-profile__avatar">
                    <ng-container *ngIf="data.profile.avatarUrl; else avatarPlaceholder">
                      <img
                        [src]="data.profile.avatarUrl ?? ''"
                        alt="Foto de perfil pública"
                        class="public-profile__avatar-image"
                      />
                    </ng-container>
                    <ng-template #avatarPlaceholder>
                      <div class="public-profile__avatar-placeholder" aria-hidden="true">
                        <span>{{ (data.profile.displayName || data.profile.slug || '?').slice(0, 1) }}</span>
                      </div>
                    </ng-template>
                  </div>

                  <div class="flex-grow-1 w-100">
                    <h2 class="h3 mb-2 text-white">
                      {{ data.profile.displayName || 'Usuario InfoTex' }}
                    </h2>
                    <p class="mb-3 text-secondary" *ngIf="data.profile.career; else noCareer">
                      {{ data.profile.career }}
                    </p>
                    <ng-template #noCareer>
                      <p class="mb-3 text-secondary">Carrera no especificada.</p>
                    </ng-template>

                    <dl class="public-profile__meta text-secondary mb-3">
                      <div *ngIf="data.profile.city || data.profile.country" class="public-profile__meta-item">
                        <dt class="visually-hidden">Ubicación</dt>
                        <dd class="mb-0">
                          {{ [data.profile.city, data.profile.country].filter(Boolean).join(', ') }}
                        </dd>
                      </div>
                      <div *ngIf="publicProfileUrl() as url" class="public-profile__meta-item">
                        <dt class="visually-hidden">Enlace público</dt>
                        <dd class="mb-0">
                          <i class="bi bi-link-45deg me-1" aria-hidden="true"></i>
                          <a [href]="url" class="link-light">{{ url }}</a>
                        </dd>
                      </div>
                    </dl>
                  </div>
                </div>

                <section class="public-profile__section">
                  <h3 class="public-profile__section-title h5 mb-3">Biografía</h3>
                  <p class="mb-0" [class.text-secondary]="!data.profile.biography">
                    {{ data.profile.biography || 'Este usuario aún no ha agregado una biografía pública.' }}
                  </p>
                </section>

                <section class="public-profile__section">
                  <div class="public-profile__section-header">
                    <div>
                      <h3 class="public-profile__section-title h5 mb-1">Educación</h3>
                      <p class="mb-0 text-secondary">
                        <ng-container *ngIf="data.education.summary as summary; else educationFallback">
                          {{
                            summary.totalRecords === 1
                              ? '1 experiencia educativa registrada.'
                              : summary.totalRecords + ' experiencias educativas registradas.'
                          }}
                        </ng-container>
                        <ng-template #educationFallback>Información académica compartida por el usuario.</ng-template>
                      </p>
                    </div>
                  </div>

                  <div *ngIf="data.education.entries.length === 0" class="text-secondary">
                    Este perfil todavía no incluye registros educativos públicos.
                  </div>

                  <article
                    class="public-profile__card"
                    *ngFor="let entry of data.education.entries; trackBy: trackByEducationId"
                  >
                    <h4 class="h6 mb-1 text-white">{{ entry.institution }}</h4>
                    <p class="mb-1 text-secondary">
                      {{ [entry.degree, entry.fieldOfStudy].filter(Boolean).join(' · ') || 'Estudios sin especificar' }}
                    </p>
                    <p class="mb-2 text-secondary">
                      {{ entry.startDate || 'Sin fecha de inicio' }}
                      <span class="mx-1">—</span>
                      {{ entry.endDate || 'En curso' }}
                    </p>
                    <p class="mb-0" *ngIf="entry.description" [innerText]="entry.description"></p>
                  </article>
                </section>

                <section class="public-profile__section">
                  <div class="public-profile__section-header">
                    <div>
                      <h3 class="public-profile__section-title h5 mb-1">Experiencia laboral</h3>
                      <p class="mb-0 text-secondary">
                        <ng-container *ngIf="data.experience.summary as summary; else experienceFallback">
                          {{
                            summary.totalRecords === 1
                              ? '1 puesto reportado.'
                              : summary.totalRecords + ' puestos reportados.'
                          }}
                        </ng-container>
                        <ng-template #experienceFallback>Historial profesional compartido.</ng-template>
                      </p>
                    </div>
                  </div>

                  <div *ngIf="data.experience.entries.length === 0" class="text-secondary">
                    Este perfil aún no muestra experiencia laboral pública.
                  </div>

                  <article
                    class="public-profile__card"
                    *ngFor="let entry of data.experience.entries; trackBy: trackByExperienceId"
                  >
                    <h4 class="h6 mb-1 text-white">{{ entry.title }}</h4>
                    <p class="mb-1 text-secondary">
                      {{ [entry.company, entry.location].filter(Boolean).join(' · ') || 'Organización no especificada' }}
                    </p>
                    <p class="mb-2 text-secondary">
                      {{ entry.startDate || 'Sin fecha de inicio' }}
                      <span class="mx-1">—</span>
                      {{ entry.endDate || 'Actualmente' }}
                    </p>
                    <p class="mb-0" *ngIf="entry.description" [innerText]="entry.description"></p>
                  </article>
                </section>

                <section class="public-profile__section">
                  <div class="public-profile__section-header">
                    <div>
                      <h3 class="public-profile__section-title h5 mb-1">Habilidades</h3>
                      <p class="mb-0 text-secondary">
                        <ng-container *ngIf="data.skills.summary as summary; else skillsFallback">
                          {{
                            summary.totalSkills === 1
                              ? '1 habilidad publicada.'
                              : summary.totalSkills + ' habilidades publicadas.'
                          }}
                        </ng-container>
                        <ng-template #skillsFallback>Competencias destacadas por el usuario.</ng-template>
                      </p>
                    </div>
                  </div>

                  <div *ngIf="data.skills.entries.length === 0" class="text-secondary">
                    Aún no se han compartido habilidades públicas.
                  </div>

                  <ul class="public-profile__skills" *ngIf="data.skills.entries.length > 0">
                    <li
                      class="public-profile__skill"
                      *ngFor="let entry of data.skills.entries; trackBy: trackBySkillId"
                    >
                      <span class="public-profile__skill-name">{{ entry.name }}</span>
                      <span class="public-profile__skill-meta" *ngIf="entry.level || entry.yearsExperience">
                        <ng-container *ngIf="entry.level">Nivel {{ entry.level }}</ng-container>
                        <ng-container *ngIf="entry.level && entry.yearsExperience">·</ng-container>
                        <ng-container *ngIf="entry.yearsExperience">
                          {{ entry.yearsExperience }} {{ entry.yearsExperience === 1 ? 'año' : 'años' }} de experiencia
                        </ng-container>
                      </span>
                    </li>
                  </ul>
                </section>
              </ng-container>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</section>
