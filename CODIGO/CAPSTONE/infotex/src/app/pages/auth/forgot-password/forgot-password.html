<section class="auth-flow" aria-labelledby="forgotPasswordTitle">
  <div class="auth-flow__container">
    <article class="auth-flow__card" *ngIf="successMessage(); else requestForm" role="status">
      <div class="auth-flow__icon auth-flow__icon--success" aria-hidden="true">âœ”</div>
      <h1 id="forgotPasswordTitle" class="auth-flow__title">Â¡Solicitud enviada!</h1>
      <p class="auth-flow__message">{{ successMessage() }}</p>
      <div class="auth-flow__actions">
        <button type="button" class="auth-flow__button" (click)="returnToLogin()">
          Volver al inicio de sesiÃ³n
        </button>
        <button type="button" class="auth-flow__link" (click)="tryAgain()">
          Â¿Ingresaste un correo incorrecto?
        </button>
      </div>
    </article>

    <ng-template #requestForm>
      <article class="auth-flow__card" role="form" aria-describedby="forgotPasswordDescription">
        <div class="auth-flow__icon" aria-hidden="true">ğŸ”</div>
        <h1 id="forgotPasswordTitle" class="auth-flow__title">Recupera tu acceso</h1>
        <p id="forgotPasswordDescription" class="auth-flow__message">
          Ingresa el correo con el que te registraste en InfoTex y te enviaremos un enlace seguro
          para restablecer tu contraseÃ±a.
        </p>

        <form class="auth-flow__form" [formGroup]="form" (ngSubmit)="submit()" novalidate>
          <label class="auth-flow__label" for="forgotEmail">Correo electrÃ³nico</label>
          <input
            id="forgotEmail"
            type="email"
            formControlName="email"
            autocomplete="email"
            [class.is-invalid]="emailControl.invalid && (emailControl.dirty || emailControl.touched)"
            [disabled]="loading()"
          />

          <div class="auth-flow__field-error" *ngIf="emailControl.hasError('required') && (emailControl.dirty || emailControl.touched)">
            El correo es obligatorio.
          </div>
          <div class="auth-flow__field-error" *ngIf="emailControl.hasError('email') && emailControl.touched">
            Ingresa un correo electrÃ³nico vÃ¡lido.
          </div>
          <div
            class="auth-flow__field-error"
            *ngIf="emailControl.hasError('invalidCharacters') && (emailControl.dirty || emailControl.touched)"
          >
            Usa solo letras, nÃºmeros y los caracteres . _ % + - @ en tu correo.
          </div>

          <button type="submit" class="auth-flow__button" [disabled]="loading()">
            <span *ngIf="!loading()">Enviar instrucciones</span>
            <span *ngIf="loading()" class="auth-flow__spinner" aria-hidden="true"></span>
            <span class="visually-hidden" *ngIf="loading()">Enviando...</span>
          </button>
        </form>

        <p class="auth-flow__feedback auth-flow__feedback--error" *ngIf="errorMessage()" role="alert">
          {{ errorMessage() }}
        </p>
        <a routerLink="/auth/login" class="auth-flow__link">Regresar al inicio</a>
      </article>
    </ng-template>
  </div>
</section>
