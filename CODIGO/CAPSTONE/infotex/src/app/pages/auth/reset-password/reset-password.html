<section class="auth-flow" aria-labelledby="resetPasswordTitle">
  <div class="auth-flow__container">
    <article class="auth-flow__card" *ngIf="successMessage(); else resetForm" role="status">
      <div class="auth-flow__icon auth-flow__icon--success" aria-hidden="true">ğŸ‰</div>
      <h1 id="resetPasswordTitle" class="auth-flow__title">ContraseÃ±a actualizada</h1>
      <p class="auth-flow__message">{{ successMessage() }}</p>
      <div class="auth-flow__actions">
        <button type="button" class="auth-flow__button" (click)="goToLogin()">
          Iniciar sesiÃ³n
        </button>
      </div>
    </article>

    <ng-template #resetForm>
      <article class="auth-flow__card" role="form" aria-describedby="resetPasswordDescription">
        <div class="auth-flow__icon" aria-hidden="true">ğŸ›¡ï¸</div>
        <h1 id="resetPasswordTitle" class="auth-flow__title">Define una nueva contraseÃ±a</h1>
        <p id="resetPasswordDescription" class="auth-flow__message">
          Crea una contraseÃ±a segura de al menos 8 caracteres. Usa una combinaciÃ³n de letras, nÃºmeros
          y sÃ­mbolos para proteger tu cuenta.
        </p>

        <form class="auth-flow__form" [formGroup]="form" (ngSubmit)="submit()" novalidate>
          <label class="auth-flow__label" for="resetPassword">Nueva contraseÃ±a</label>
          <input
            id="resetPassword"
            type="password"
            formControlName="password"
            autocomplete="new-password"
            [class.is-invalid]="passwordControl.invalid && (passwordControl.dirty || passwordControl.touched)"
            [disabled]="loading() || tokenMissing()"
          />
          <div class="auth-flow__field-error" *ngIf="passwordControl.hasError('required') && (passwordControl.dirty || passwordControl.touched)">
            La contraseÃ±a es obligatoria.
          </div>
          <div class="auth-flow__field-error" *ngIf="passwordControl.hasError('minlength') && passwordControl.touched">
            Debe tener al menos 8 caracteres.
          </div>

          <label class="auth-flow__label" for="resetPasswordConfirmation">Confirma tu nueva contraseÃ±a</label>
          <input
            id="resetPasswordConfirmation"
            type="password"
            formControlName="passwordConfirmation"
            autocomplete="new-password"
            [class.is-invalid]="
              passwordConfirmationControl.invalid &&
              (passwordConfirmationControl.dirty || passwordConfirmationControl.touched)
            "
            [disabled]="loading() || tokenMissing()"
          />
          <div class="auth-flow__field-error" *ngIf="passwordConfirmationControl.hasError('required') && (passwordConfirmationControl.dirty || passwordConfirmationControl.touched)">
            Debes confirmar la contraseÃ±a.
          </div>
          <div class="auth-flow__field-error" *ngIf="
              form.hasError('passwordMismatch') &&
              !passwordConfirmationControl.hasError('required') &&
              passwordConfirmationControl.touched
            ">
            Las contraseÃ±as no coinciden.
          </div>

          <button type="submit" class="auth-flow__button" [disabled]="loading() || tokenMissing()">
            <span *ngIf="!loading()">Guardar contraseÃ±a</span>
            <span *ngIf="loading()" class="auth-flow__spinner" aria-hidden="true"></span>
            <span class="visually-hidden" *ngIf="loading()">Guardando contraseÃ±aâ€¦</span>
          </button>
        </form>

        <p class="auth-flow__feedback auth-flow__feedback--error" *ngIf="errorMessage()" role="alert">
          {{ errorMessage() }}
        </p>
        <a routerLink="/auth/forgot-password" class="auth-flow__link">Solicitar un nuevo enlace</a>
      </article>
    </ng-template>
  </div>
</section>
